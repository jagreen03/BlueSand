#!/usr/bin/env bash
set -euo pipefail

# Only run when relevant files are staged (super fast)
changed="$(git diff --cached --name-only || true)"

needs_check=0
echo "$changed" | grep -E '^(config/bluesand\.yaml|scripts/BlueSand-Scan\.ps1|scripts/BlueSand-QuickCheck\.ps1)$' >/dev/null && needs_check=1

if [ "$needs_check" = "1" ]; then
  echo "[pre-commit] BlueSand quick checkâ€¦"
  if command -v pwsh >/dev/null 2>&1; then
    pwsh -NoProfile -File scripts/BlueSand-QuickCheck.ps1
  else
    powershell -NoProfile -ExecutionPolicy Bypass -File scripts/BlueSand-QuickCheck.ps1
  fi
fi
